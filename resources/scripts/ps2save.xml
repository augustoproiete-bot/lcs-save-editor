<?xml version="1.0" encoding="UTF-8"?>

<!--
    This is a Cascara layout script.
    Visit https://github.com/whampson/cascara for more info.
-->

<layoutScript game="LCS" platform="PS2">
    <include path="types.xml"/>

    <struct name="simpleVars">
        <BlockHeader name="header"/>
        <align count="4" kind="uint16"/>
        <uint32 name="currentLevel"/>
        <uint32 name="currentArea"/>
        <uint32 name="prefsLanguage"/>
        <uint32 name="millisecondsPerGameMinute"/>
        <uint32 name="lastClockTick"/>
        <uint8 name="gameClockHours"/>
        <uint8 name="gameClockMinutes"/>
        <uint16 name="_gameClockSeconds"/>
        <uint32 name="totalTimePlayedInMilliseconds"/>
        <float name="_timeScale"/>
        <float name="_timeStep"/>
        <float name="_timeScaleNonClipped"/>
        <float name="_framesPerUpdate"/>
        <uint32 name="frameCounter"/>
        <int16 name="previousWeather"/>
        <int16 name="currentWeather"/>
        <int16 name="forcedWeather"/>
        <align count="2"/>
        <uint32 name="weatherIndex"/>
        <float name="weatherInterpolation"/>
        <Vector3d name="cameraPosition"/>
        <float name="prefsVehicleCameraMode"/>
        <align count="1" kind="float"/>
        <align count="2" kind="uint32"/>
        <align count="1" kind="float"/>
        <uint32 name="prefsBrightness"/>
        <bool8 name="prefsShowHud"/>
        <bool8 name="prefsShowSubtitles"/>
        <align count="2"/>
        <uint32 name="radarMode"/>
        <bool32 name="blurOn"/>
        <align count="2" kind="uint32"/>
        <bool8 name="prefsUseWideScreen"/>
        <align count="3"/>
        <uint32 name="prefsRadioVolume"/>
        <uint32 name="prefsSfxVolume"/>
        <uint8 name="_prefsRadioStation"/>
        <uint8 name="_prefsOutput"/>
        <align count="2"/>
        <align count="10" kind="uint32"/>
        <align count="1" kind="float"/>
        <uint16 name="controllerConfiguration"/>
        <align count="1" kind="uint16"/>
        <bool32 name="prefsDisableInvertLook"/>
        <bool8 name="prefsUseVibration"/>
        <align count="3"/>
        <bool32 name="hasPlayerCheated"/>
        <bool32 name="_allTaxisHaveNitro"/>
        <bool32 name="targetIsOn"/>
        <Vector2d name="targetPosition"/>
        <align count="1" kind="uint32"/>
        <struct name="timestamp">
            <uint32 name="second"/>
            <uint32 name="minute"/>
            <uint32 name="hour"/>
            <uint32 name="day"/>
            <uint32 name="month"/>
            <uint32 name="year"/>
        </struct>
    </struct>

    <typedef name="ScriptVariable" kind="union">
        <int32 name="valueAsInt"/>
        <float name="valueAsFloat"/>
        <bool32 name="valueAsBoolean"/>
    </typedef>
    
    
    
    <struct name="scripts">
        <BlockHeader name="header"/>
        <BlockHeader name="nestedHeader"/>
        <uint32 name="globalVariablesSize"/>
        
        <!-- TODO:
                remove 'align' - it is pointless
                (just use <byte count="16"/> or <uint count="32"/>)
                implement '$SizeOf(<type>)'
        -->
        <ScriptVariable name="globalVariables" count="${globalVariablesSize} / 4"/>
        <uint32/>
        <uint32 name="onAMissionFlag"/>
        <uint32 name="timeLastMissionPassed"/>
        <struct count="32">
            <uint32/>
            <uint32/>
        </struct>
        <uint32/>
        <struct name="buildingSwapArray" count="80">
            <uint32 name="objectType"/>
            <uint32 name="objectIndex"/>
            <int32 name="newModel"/>
            <int32 name="oldModel"/>
        </struct>
        <struct name="invisibilitySettingArray" count="52">
            <uint32 name="objectType"/>
            <uint32 name="objectIndex"/>
        </struct>
        <bool name="usingAMultiScriptFile"/>
        <bool/>
        <byte count="2"/>
        <uint32 name="mainScriptSize"/>
        <uint32 name="largestMissionScriptSize"/>
        <uint16 name="numberOfMissionScripts"/>
        <byte count="2"/>
        <uint16 name="numberOfExclusiveMissionScripts"/>
        <byte count="2"/>
        <struct name="runningScripts" count="${numberOfExclusiveMissionScripts}">
            <uint32 name="nextScriptPointer"/>
            <uint32 name="previousScriptPointer"/>
            <uint32 name="threadId"/>
            <uint32/>
            <char name="name" count="8"/>
            <uint32 name="instructionPointer"/>
            <uint32 name="returnStack" count="16"/>
            <uint16 name="returnStackTop"/>
            <uint16/>
            <ScriptVariable name="variables" count="104"/>
            <uint32 name="timerA"/>
            <uint32 name="timerB"/>
            <uint32/>
            <bool count="4"/>
            <uint32 name="wakeupTime"/>
            <bool count="4"/>
            <uint32/>
        </struct>
    </struct>

    <echo message="sizeof(scripts) = $SizeOf(scripts)"/> 
    <echo message="scripts.header.size = ${scripts.header.size}"/> <!-- 'blockSize' not 'size' -->
</layoutScript>
